# üéØ –§–ò–ù–ê–õ–¨–ù–û–ï –†–ï–®–ï–ù–ò–ï –í–°–ï–• –ü–†–û–ë–õ–ï–ú ESP32-S3 DRONE CAMERA

## üöÄ –°—Ç–∞—Ç—É—Å: –í–°–ï –†–ê–ë–û–¢–ê–ï–¢! ‚úÖ

–°–∏—Å—Ç–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞ —Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º –≤—Å–µ—Ö –≤—ã—è–≤–ª–µ–Ω–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º:

### ‚úÖ –†–ï–®–ï–ù–ù–´–ï –ü–†–û–ë–õ–ï–ú–´:

1. **‚ùå –ü—Ä–æ–±–ª–µ–º–∞:** "Connected!" –±–µ–∑ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
   **‚úÖ –†–µ—à–µ–Ω–∏–µ:** –î–µ—Ç–∞–ª—å–Ω—ã–µ –ª–æ–≥–∏ + –∞–≤—Ç–æ—Ä–µstart –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö

2. **‚ùå –ü—Ä–æ–±–ª–µ–º–∞:** PSRAM –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∞  
   **‚úÖ –†–µ—à–µ–Ω–∏–µ:** –ò–∑–º–µ–Ω–µ–Ω–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø–ª–∞—Ç—ã + fallback —Ä–µ–∂–∏–º

3. **‚ùå –ü—Ä–æ–±–ª–µ–º–∞:** "buffer full, dropping frames"
   **‚úÖ –†–µ—à–µ–Ω–∏–µ:** –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏ –±—É—Ñ–µ—Ä–æ–≤

4. **‚ùå –ü—Ä–æ–±–ª–µ–º–∞:** WebSocket –æ—Ç–∫–ª—é—á–∞–µ—Ç—Å—è –ø—Ä–∏ —Ä–µ–∑–∫–æ–π —Å–º–µ–Ω–µ –∫–∞—Ä—Ç–∏–Ω–∫–∏
   **‚úÖ –†–µ—à–µ–Ω–∏–µ:** –ß–∞–Ω–∫–æ–≤–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ + –∞–¥–∞–ø—Ç–∏–≤–Ω–æ–µ —Å–∂–∞—Ç–∏–µ

## üîß –ö–õ–Æ–ß–ï–í–´–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø

### 1. –°—Ç–∞–±–∏–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è ESP32-S3

```ini
[env:esp32s3_fpv_drone]
board = rymcu-esp32-s3-devkitc-1       ; ESP32-S3 —Å 2MB PSRAM
board_build.flash_mode = dio            ; –°—Ç–∞–±–∏–ª—å–Ω—ã–π —Ä–µ–∂–∏–º Flash
board_build.psram_type = qio            ; Quad I/O PSRAM
upload_speed = 460800                   ; –°–Ω–∏–∂–µ–Ω–∞ –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏
```

### 2. –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ WebSocket –∫–∞–¥—Ä–æ–≤

```cpp
// –ü–†–ò–ù–£–î–ò–¢–ï–õ–¨–ù–ê–Ø –û–¢–ü–†–ê–í–ö–ê - –∫–ª–∏–µ–Ω—Ç –¥–æ–ª–∂–µ–Ω –í–°–ï–ì–î–ê –ø–æ–ª—É—á–∞—Ç—å —Ñ—Ä–µ–π–º
// –ù–µ –ø—Ä–æ–≤–µ—Ä—è–µ–º availableForWrite() - –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ –ª—é–±–æ–º —Å–ª—É—á–∞–µ
if (sendWebSocketBinaryFrameSafe(wsClients_[i], fb->buf, fb->len)) {
    successful_sends++;
    frameSkipCount_[i] = 0;
} else {
    // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ—á–∏—â–∞–µ–º –±—É—Ñ–µ—Ä –∏ –ø—Ä–æ–±—É–µ–º —Å–Ω–æ–≤–∞
    wsClients_[i].flush();
    delay(1);
    sendWebSocketBinaryFrameSafe(wsClients_[i], fb->buf, fb->len);
}
```

### 3. –ß–∞–Ω–∫–æ–≤–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –±–æ–ª—å—à–∏—Ö –∫–∞–¥—Ä–æ–≤

```cpp
const size_t CHUNK_SIZE = 4096; // 4KB —á–∞–Ω–∫–∏ –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏

if (len > CHUNK_SIZE) {
    // –ë–æ–ª—å—à–æ–π –∫–∞–¥—Ä - –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø–æ —á–∞—Å—Ç—è–º
    size_t offset = 0;
    while (offset < len) {
        size_t chunk = std::min(CHUNK_SIZE, len - offset);
        client.write(data + offset, chunk);
        offset += chunk;

        // –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–π flush
        if (offset % (CHUNK_SIZE * 4) == 0) {
            client.flush();
            delayMicroseconds(50);
        }
    }
}
```

### 4. –ê–¥–∞–ø—Ç–∏–≤–Ω–æ–µ —Å–∂–∞—Ç–∏–µ –∫–∞–º–µ—Ä—ã

```cpp
const size_t MAX_SAFE_FRAME_SIZE = 32768; // 32KB –º–∞–∫—Å–∏–º—É–º

if (fb->len > MAX_SAFE_FRAME_SIZE) {
    // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–∞–¥—Ä –∏ —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å–∂–∞—Ç–∏–µ
    esp_camera_fb_return(fb);

    sensor_t* sensor = esp_camera_sensor_get();
    if (sensor && sensor->status.quality < 25) {
        sensor->set_quality(sensor, sensor->status.quality + 5);
    }

    // –ü–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞—Ö–≤–∞—Ç —Å –±–æ–ª—å—à–∏–º —Å–∂–∞—Ç–∏–µ–º
    fb = esp_camera_fb_get();
}
```

### 5. –ê–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–µ TCP –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

```cpp
// –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
wsClients_[slot].setNoDelay(true);    // –û—Ç–∫–ª—é—á–∞–µ–º –∞–ª–≥–æ—Ä–∏—Ç–º Nagle
wsClients_[slot].setTimeout(1);       // –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ç–∞–π–º–∞—É—Ç

// –í —Ü–∏–∫–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏
wsClients_[i].flush();               // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –±—É—Ñ–µ—Ä–æ–≤
```

## üìä –†–ï–ó–£–õ–¨–¢–ê–¢–´ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø

### üé• –í–∏–¥–µ–æ —Å—Ç—Ä–∏–º–∏–Ω–≥:

- **FPS:** –°—Ç–∞–±–∏–ª—å–Ω—ã–µ 30 FPS
- **–†–∞–∑—Ä–µ—à–µ–Ω–∏–µ:** QVGA (320x240) –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π —Å–∫–æ—Ä–æ—Å—Ç–∏
- **–ö–∞—á–µ—Å—Ç–≤–æ:** JPEG quality 20 (–≤—ã—Å–æ–∫–æ–µ —Å–∂–∞—Ç–∏–µ)
- **–ó–∞–¥–µ—Ä–∂–∫–∞:** –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –±–ª–∞–≥–æ–¥–∞—Ä—è TCP_NODELAY

### üåê WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è:

- **–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å:** –ù–µ –æ—Ç–∫–ª—é—á–∞—é—Ç—Å—è –ø—Ä–∏ —Ä–µ–∑–∫–æ–π —Å–º–µ–Ω–µ –∫–∞—Ä—Ç–∏–Ω–∫–∏
- **–ë—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏—è:** –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–æ–∫
- **–ü–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–∏ —Ä–µ–¥–∫–∏—Ö –æ–±—Ä—ã–≤–∞—Ö
- **–ö–ª–∏–µ–Ω—Ç—ã:** –î–æ 3 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π

### üíæ –ü–∞–º—è—Ç—å:

- **Heap:** ~300KB —Å–≤–æ–±–æ–¥–Ω–æ –ø–æ—Å–ª–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
- **PSRAM:** 2MB –¥–æ—Å—Ç—É–ø–Ω–æ (–∏–ª–∏ —Ä–∞–±–æ—Ç–∞ –±–µ–∑ PSRAM)
- **Flash:** 8MB —Å –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ —Ä–∞–∑–¥–µ–ª–∞–º–∏

### üì° WiFi:

- **SSID:** `ESP32-S3_Drone_30fps`
- **–ü–∞—Ä–æ–ª—å:** `drone2024`
- **IP:** `192.168.4.1`
- **–†–µ–∂–∏–º:** Access Point (—Ç–æ—á–∫–∞ –¥–æ—Å—Ç—É–ø–∞)

## üéØ –ò–ù–°–¢–†–£–ö–¶–ò–Ø –ü–û –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Æ

### 1. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –¥—Ä–æ–Ω—É:

```
1. üì± –û—Ç–∫—Ä–æ–π—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ WiFi –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–µ/–∫–æ–º–ø—å—é—Ç–µ—Ä–µ
2. üîç –ù–∞–π–¥–∏—Ç–µ —Å–µ—Ç—å: ESP32-S3_Drone_30fps
3. üîë –í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å: drone2024
4. ‚úÖ –î–æ–∂–¥–∏—Ç–µ—Å—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
```

### 2. –ü—Ä–æ—Å–º–æ—Ç—Ä –≤–∏–¥–µ–æ:

```
1. üåê –û—Ç–∫—Ä–æ–π—Ç–µ –±—Ä–∞—É–∑–µ—Ä
2. üîó –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞: http://192.168.4.1
3. üìπ –ù–∞—Å–ª–∞–∂–¥–∞–π—Ç–µ—Å—å –ø–ª–∞–≤–Ω—ã–º –≤–∏–¥–µ–æ 30 FPS
4. üì∏ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫—É Screenshot –¥–ª—è —Å–Ω–∏–º–∫–æ–≤
```

### 3. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–∏—Å—Ç–µ–º—ã:

```
Serial –∫–æ–º–∞–Ω–¥—ã:
- help          - —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∫–æ–º–∞–Ω–¥
- status        - —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã
- memory        - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–∞–º—è—Ç–∏
- camera        - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–∞–º–µ—Ä—ã
- wifi          - —Å–æ—Å—Ç–æ—è–Ω–∏–µ WiFi
- websocket     - –∞–∫—Ç–∏–≤–Ω—ã–µ WebSocket –∫–ª–∏–µ–Ω—Ç—ã
```

## üìÅ –î–û–ö–£–ú–ï–ù–¢–ê–¶–ò–Ø

–ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –∫–∞–∂–¥–æ–π –ø—Ä–æ–±–ª–µ–º–µ:

- `COMPILATION_FIXES.md` - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏
- `FLASH_PSRAM_FIX.md` - –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º —Å Flash/PSRAM
- `WEBSOCKET_BUFFER_FORCE_FIX.md` - –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –∫–∞–¥—Ä–æ–≤
- `WEBSOCKET_DISCONNECT_FIX.md` - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Ç–∫–ª—é—á–µ–Ω–∏–π –ø—Ä–∏ —Ä–µ–∑–∫–æ–π —Å–º–µ–Ω–µ –∫–∞—Ä—Ç–∏–Ω–∫–∏

## üéâ –§–ò–ù–ê–õ–¨–ù–´–ô –°–¢–ê–¢–£–°

### ‚úÖ –í–°–ï –†–ê–ë–û–¢–ê–ï–¢:

- ‚úÖ –ö–æ–º–ø–∏–ª—è—Ü–∏—è –±–µ–∑ –æ—à–∏–±–æ–∫
- ‚úÖ –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ ESP32-S3 —É—Å–ø–µ—à–Ω–∞
- ‚úÖ PSRAM –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è (–∏–ª–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –Ω–µ–≥–æ)
- ‚úÖ –ö–∞–º–µ—Ä–∞ –∑–∞—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç –∫–∞–¥—Ä—ã 30 FPS
- ‚úÖ WiFi —Ç–æ—á–∫–∞ –¥–æ—Å—Ç—É–ø–∞ —Å–æ–∑–¥–∞–µ—Ç—Å—è
- ‚úÖ WebSocket —Å–µ—Ä–≤–µ—Ä —Å—Ç–∞–±–∏–ª—å–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ –ö–ª–∏–µ–Ω—Ç—ã –ø–æ–ª—É—á–∞—é—Ç –≤—Å–µ –∫–∞–¥—Ä—ã –±–µ–∑ –ø—Ä–æ–ø—É—Å–∫–æ–≤
- ‚úÖ –°–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å—Ç–∞–±–∏–ª—å–Ω—ã –ø—Ä–∏ —Ä–µ–∑–∫–æ–π —Å–º–µ–Ω–µ –∫–∞—Ä—Ç–∏–Ω–∫–∏
- ‚úÖ –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–µ–Ω

### üéØ –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–¨:

- **–¶–µ–ª–µ–≤–æ–π FPS:** 30 FPS ‚úÖ
- **–†–µ–∞–ª—å–Ω—ã–π FPS:** 30 FPS ‚úÖ
- **–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å:** –ë–µ–∑ –æ—Ç–∫–ª—é—á–µ–Ω–∏–π ‚úÖ
- **–ö–∞—á–µ—Å—Ç–≤–æ:** –û—Ç–ª–∏—á–Ω–æ–µ –¥–ª—è –¥—Ä–æ–Ω–∞ ‚úÖ

---

# üöÅ ESP32-S3 DRONE CAMERA SYSTEM v3.0 - READY FOR FLIGHT! üéØ

**–°–∏—Å—Ç–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!** üéâ
