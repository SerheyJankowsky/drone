; PlatformIO Project Configuration File для ESP32-S3 FPV Drone Camera
;
; Оптимизированная конфигурация для стабильной работы камеры
; и высокой производительности стриминга
;
; Документация: https://docs.platformio.org/page/projectconf.html

[env:esp32s3_fpv_drone]
platform = espressif32
board = esp32-s3-devkitc-1              ; Стандартная ESP32-S3 плата
framework = arduino

; === Настройки загрузки и мониторинга ===
upload_speed = 460800                    ; Сниженная скорость для стабильности
monitor_speed = 115200                   ; Скорость Serial монитора  
monitor_filters = esp32_exception_decoder ; Декодирование исключений
upload_protocol = esptool                ; Принудительно используем esptool
monitor_rts = 0                          ; Отключаем RTS для стабильного мониторинга
monitor_dtr = 0                          ; Отключаем DTR для стабильного мониторинга

; === Оптимизация памяти для камеры ===
board_build.flash_mode = dio            ; Dual I/O режим Flash (совместимый)
board_build.flash_size = 8MB            ; Реальный размер Flash памяти
; board_build.psram_type = qio          ; ОТКЛЮЧЕНО: проблемы с обнаружением PSRAM
board_build.partitions = huge_app.csv   ; Большие разделы для приложения

; === Флаги компиляции для производительности ===
build_flags = 
    -DCORE_DEBUG_LEVEL=3                ; УВЕЛИЧЕН уровень отладки для диагностики
    -DCONFIG_CAMERA_MODULE_ESP32S3_EYE  ; Поддержка ESP32-S3 камеры
    ; -DBOARD_HAS_PSRAM                 ; ОТКЛЮЧЕНО: проблемы с PSRAM
    ; -DCONFIG_ESP32S3_SPIRAM_SUPPORT=1 ; ОТКЛЮЧЕНО: поддержка SPIRAM
    ; -DCONFIG_SPIRAM_USE_MALLOC=1      ; ОТКЛЮЧЕНО: использование PSRAM для malloc
    ; -DPSRAM_MODE=1                    ; ОТКЛЮЧЕНО: режим PSRAM
    -DCONFIG_ESP32S3_DEFAULT_CPU_FREQ_240=1 ; 240MHz CPU
    -DCONFIG_BOOTLOADER_LOG_LEVEL=3     ; Подробные логи загрузчика
    -DCONFIG_LOG_DEFAULT_LEVEL=3        ; Подробные системные логи
    -DARDUINO_USB_CDC_ON_BOOT=1         ; USB CDC для отладки
    -Os                                 ; Оптимизация размера кода

; === Библиотеки ===
lib_deps =
    espressif/esp32-camera@^2.0.4      ; Драйвер камеры ESP32

